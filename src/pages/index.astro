---
import Layout from "../layouts/Layout.astro";
import Socials from "../components/Socials.astro";
import { getCollection } from "astro:content";
import { LANGUAGE } from "../const";
import "../styles/home.css";

const title = { page: "Jorman Espinoza" };

const experiences = (await getCollection("experience")).slice(0, 3);
const education = (await getCollection("education")).slice(0, 3);
const projects = (
  await getCollection("projects", ({ data }) => data.visible)
).slice(0, 3);
const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const formatDate = (d: Date) =>
  d.toLocaleDateString(LANGUAGE.regional, {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
---

<Layout title={title}>
  <section class="hero">
    <h2>Código con propósito</h2>
    <p>Desarrollador Full Stack con foco en experiencias digitales.</p>
    <a class="cta" href="/contact">Contáctame</a>
  </section>

  <section class="home-section" id="experience">
    <h2>Experiencia</h2>
    <ul class="item-list">
      {
        experiences.map((exp) => (
          <li>
            <strong>{exp.data.entity.name}</strong>
            <div>{exp.data.positions[0].title}</div>
            <div class="item-interval">{exp.data.interval}</div>
          </li>
        ))
      }
    </ul>
    <a class="more" href="/experience">Ver toda la experiencia →</a>
  </section>

  <section class="home-section" id="education">
    <h2>Educación</h2>
    <ul class="item-list">
      {
        education.map((edu) => (
          <li>
            <strong>{edu.data.title}</strong>
            <div>{edu.data.entity.name}</div>
            <div class="item-interval">{edu.data.interval}</div>
          </li>
        ))
      }
    </ul>
    <a class="more" href="/education">Ver educación →</a>
  </section>

  <section class="home-section" id="projects">
    <h2>Proyectos</h2>
    <ul class="item-list">
      {
        projects.map((proj) => (
          <li>
            <strong>{proj.data.name}</strong>
            <div>{proj.data.summary}</div>
          </li>
        ))
      }
    </ul>
    <a class="more" href="/projects">Ver todos los proyectos →</a>
  </section>

  <section class="home-section" id="blog">
    <h2>Blog</h2>
    <ul class="item-list">
      {
        posts.map((post) => (
          <li>
            <a href={`/blog/${post.id}/`}>{post.data.title}</a>
            <div class="item-date">{formatDate(post.data.pubDate)}</div>
          </li>
        ))
      }
    </ul>
    <a class="more" href="/blog">Ir al blog →</a>
  </section>

  <Socials template="icons" />
</Layout>
